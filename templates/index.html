<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baú de Receitas - Forja de Receitas Épicas</title>
    <link rel="stylesheet" href="{{ url_for('static_files', filename='style.css') }}">
</head>
<body>
    <div class="main-container"> {# Add main-container class #}
        <h1>⚔️ Baú de Receitas ⚔️</h1>
        <p>Bem-vindo ao Baú de Receitas! Entre na <strong>Forja de Fórmulas Épicas</strong>!</p>
        <p>Informe os ingredientes que você possui em seu inventário, e nossos Mestres Culinários Alquimistas conjurarão uma receita exclusiva para você.</p>
        <hr>

        <h2>🔥 A Forja de Fórmulas Épicas 🔥</h2>

        <div class="input-area"> {# Optional: Add a class for input area if specific styling is needed #}
            <h3>📜 Ingredientes em Seu Inventário:</h3>
            <form method="POST">
                <textarea name="ingredients" rows="4" placeholder="Ex: casca de abóbora, talo de brócolis, pão amanhecido, cenoura murcha...">{{ ingredients }}</textarea>
                <button type="submit">✨ FORJAR RECEITA! ✨</button>
            </form>
        </div>

        <div class="recipe-output-area"> {# Add recipe-output-area class #}
            <h3>📖 Fórmula Mágica Revelada: 📖</h3>
            {% if error_message %}
                <div class="error-message">{{ error_message }}</div> {# Add error-message class #}
            {% elif rendered_recipe_html %} {# <--- Use a nova variável para o HTML renderizado #}
                <div class="recipe-content"> {# Add recipe-content class #}
                    {{ rendered_recipe_html | safe }} {# O | safe ainda é necessário pois agora é HTML gerado por nós #}
                </div>
                {# Use the sanitized filename passed from the Flask route #}
                <a href="#" id="download-button" download="{{ download_filename }}">📜 Baixar Pergaminho da Receita</a>
                <script>
                    // Dynamically set the download content
                    document.getElementById('download-button').onclick = function() {
                        // Use a variável com o conteúdo Markdown original para o download
                        var content = `{{ raw_markdown_content_for_download | safe }}`; // <--- Use a variável para download
                        var blob = new Blob([content], { type: 'text/plain' });
                        this.setAttribute('href', URL.createObjectURL(blob));
                        // The 'download' attribute is already set by Flask
                    };
                </script>

            {% else %}
                <div class="info-message"> {# Add info-message class #}
                    <p>Sua receita épica aparecerá aqui após a forja!</p>
                    <p>Prepare seus utensílios e acenda o fogo do dragão!</p>
                </div>
            {% endif %}
        </div>

        <hr>
        <div class="footer-custom"> {# Keep footer-custom class #}
            <p>&copy; 2025 Baú de Receitas. Todos os direitos reservados. Forjado com Magia e Aproveitamento.</p>
        </div>
    </div> {# Close main-container div #}
</body>
</html>